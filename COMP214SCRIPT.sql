-- DROP SEQUENCES
DROP SEQUENCE SEQUENCE_COMPANYID;
DROP SEQUENCE SEQUENCE_DEPARTMENTID;
DROP SEQUENCE SEQUENCE_EMPLOYEEID;
DROP SEQUENCE SEQUENCE_TAXID;
DROP SEQUENCE SEQUENCE_HELPDESKID;
DROP SEQUENCE SEQUENCE_LOANID;

-- DROP TABLES
DROP TABLE EMPLOYEE CASCADE CONSTRAINTS;
DROP TABLE LOAN CASCADE CONSTRAINTS;
DROP TABLE TAX CASCADE CONSTRAINTS;
DROP TABLE COMPANY CASCADE CONSTRAINTS;
DROP TABLE DEPARTMENT CASCADE CONSTRAINTS;
DROP TABLE HELPDESK CASCADE CONSTRAINTS;


-- CREATE TABLES, SEQUENCES FOR TABLES AND INSERT FIRST 10 ROWS INTO TABLES
CREATE TABLE COMPANY 
(
  COMPANYID NUMBER(38, 0) NOT NULL, 
  COMPANYNAME VARCHAR2(200) NOT NULL, 
  ADDRESS VARCHAR2(200) NOT NULL,
  PRIMARY KEY (COMPANYID) ENABLE 
);

CREATE SEQUENCE SEQUENCE_COMPANYID
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 10;

INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'IBM','Frankfurt');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'Scott.CO','Jamaica');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'FOOD PANDA','Canada');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'Capgemini','Toronto');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'Oracle','Cuba');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'Apple.CO','Bahamas');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'Bartaha','Brazil');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'Cococola','India');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'North-face','China');
INSERT INTO Company (Companyid,Companyname,address) VALUES (SEQUENCE_COMPANYID.NEXTVAL,'JD and CO','Vietam');



CREATE TABLE DEPARTMENT 
(
  DEPARTMENTID NUMBER(38, 0) NOT NULL,
  DEPARTMENTNAME VARCHAR2(200) NOT NULL,
  COMPANYID NUMBER(38,0) NOT NULL,
  PRIMARY KEY (DEPARTMENTID )ENABLE,
  FOREIGN KEY(COMPANYID) REFERENCES COMPANY(COMPANYID) ENABLE
);

CREATE SEQUENCE SEQUENCE_DEPARTMENTID
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 10;

INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'IT', 1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'IT', 1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'Food', 1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'Consulting' ,1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'DBA' ,1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'Systems_analysis' ,1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'IT', 1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'Administration', 1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'Products-sale', 1);
INSERT INTO DEPARTMENT (DEPARTMENTID, DEPARTMENTNAME, COMPANYID) VALUES(SEQUENCE_DEPARTMENTID.NEXTVAL, 'Administration', 1);



CREATE TABLE EMPLOYEE 
(
  EMPLOYEEID NUMBER(38, 0) NOT NULL, 
  FIRSTNAME VARCHAR2(200) NOT NULL,
  LASTNAME VARCHAR2(200) NOT NULL,
  USERNAME VARCHAR2(200) NOT NULL,
  PASSWORD VARCHAR2(200) NOT NULL,
  ADDRESS VARCHAR2(200) NOT NULL,
  CITY VARCHAR2(200) NOT NULL,
  STATE VARCHAR2(200) NOT NULL,
  ZIP VARCHAR2(200) NOT NULL,
  PHONENUMBER VARCHAR2(200) NOT NULL,
  DEPARTMENTID NUMBER(38, 0),
  COMPANYID NUMBER(38,0) NOT NULL,
  PRIMARY KEY (EMPLOYEEID) ENABLE,
  FOREIGN KEY(COMPANYID) REFERENCES COMPANY(COMPANYID) ENABLE
);

CREATE SEQUENCE SEQUENCE_EMPLOYEEID
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 10;

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID) 
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'Alessio', 'Iannella', 'alexroma87', 'password', '123 College St', 'Toronto', 'ON', 'M5C3P4', '4167890987', 1, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID) 
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'Joe', 'Rush', 'joerush', 'password', '123 Main St', 'Toronto', 'ON', 'M5C3P6', '4167890687', 2, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID)
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'John', 'Hurt', 'johnhurt', 'password', '123 Bay St', 'Toronto', 'ON', 'M5T3P4', '4167690987', 3, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID)
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'Sarah', 'Connor', 'sarahconnor', 'password', '123 Yonge St', 'Toronto', 'ON', 'M3C3P4', '4167390987', 4, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID)
VALUES(SEQUENCE_EMPLOYEEID.NEXTVAL, 'Huy', 'Nguyen', 'huynguyen', 'password', '123 Bay St', 'Toronto', 'ON', 'M5T3P4', '4167891987', 5, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID)
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'Ted', 'Mosby', 'tedmosby', 'password', '123 Roseheath Ave', 'Toronto', 'ON', 'M5D3P4', '4167890587', 6, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID)
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'Marshall', 'Eriksen', 'marshalleriksen', 'password', '123 Dufferin St', 'Toronto', 'ON', 'M5R3P4', '4167870987', 7, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID)
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'Lily', 'Auldrin', 'lilyauldrin', 'password', '123 Danforth Ave', 'Toronto', 'ON', 'M3C3P4', '4167897987', 8, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID)
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'Barney', 'Stinson', 'barneystinson', 'password', '123 Gerrard St', 'Toronto', 'ON', 'M5C3P7', '4157890987', 1, 1);

INSERT INTO EMPLOYEE (EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID)
VALUES (SEQUENCE_EMPLOYEEID.NEXTVAL, 'Robin', 'Scherbastsky', 'robin', 'password', '123 Dandorth Ave', 'Toronto', 'ON', 'N5C3P4', '4167890387', 2, 1);


CREATE TABLE TAX 
(
  TAXID NUMBER(38,0) NOT NULL,
  TAXVALUE NUMBER(38, 2) NOT NULL,
  DOCUMENT VARCHAR2(200) NOT NULL,
  TAXYEAR NUMBER(4,0) NOT NULL,
  EMPLOYEEID NUMBER(38,0) NOT NULL,
  PRIMARY KEY (TAXID) ENABLE,
  FOREIGN KEY (EMPLOYEEID) REFERENCES EMPLOYEE(EMPLOYEEID) ENABLE
);

CREATE SEQUENCE SEQUENCE_TAXID
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 10;

INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 4850.50, 'T4', 2015, 1);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 150.00, 'T5', 2014, 2);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 1200.00, 'T4', 2013, 3);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 750.00, 'T4', 2012, 4);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 3400.50, 'T4', 2013, 5);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 2450.50, 'T4', 2014, 6);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 750.50, 'T4', 2015, 7);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 1300.50, 'T4', 2015, 8);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 4000.50, 'T4', 2013, 9);
INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) VALUES (SEQUENCE_TAXID.NEXTVAL, 3200.50, 'T4', 2014, 1);



CREATE TABLE HELPDESK 
(
  HELPDESKID NUMBER(38,0) NOT NULL,
  HELPDESKNAME VARCHAR2(200) NOT NULL,
  EMPLOYEEID NUMBER(38,0) NOT NULL,
  DESCRIPTION VARCHAR2(200) NOT NULL,
  PRIMARY KEY (HELPDESKID) ENABLE
);

CREATE SEQUENCE SEQUENCE_HELPDESKID
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 10;

INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_1', 1, 'Help desk 1 for IT room');
INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_2', 2, 'Help desk 2 for IT room');
INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_3', 3, 'Help desk 3 for IT room');
INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_4', 4, 'Help desk 4 for IT room');
INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_5', 5, 'Help desk 5 for IT room');
INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_6', 6, 'Help desk 6 for IT room');
INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_7', 7, 'Help desk 7 for IT room');
INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_9', 9, 'Help desk 9 for IT room');
INSERT INTO HELPDESK (HELPDESKID, HELPDESKNAME, EMPLOYEEID, DESCRIPTION) VALUES (SEQUENCE_HELPDESKID.NEXTVAL, 'HD_ROOM_10', 10, 'Help desk 10 for IT room');



CREATE TABLE LOAN 
(
  LOANID NUMBER(38,0) NOT NULL,
  LOANVALUE NUMBER(38,2) NOT NULL,
  COMPANYID NUMBER(38,0) NOT NULL,
  EMPLOYEEID NUMBER(38,0) NOT NULL,
  PRIMARY KEY (LOANID) ENABLE,
  FOREIGN KEY (COMPANYID) REFERENCES COMPANY(COMPANYID) ENABLE,
  FOREIGN KEY (EMPLOYEEID) REFERENCES EMPLOYEE(EMPLOYEEID) ENABLE
);

CREATE SEQUENCE SEQUENCE_LOANID
MINVALUE 1
START WITH 1
INCREMENT BY 1
CACHE 10;

INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 3000.00, 1, 1);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 1000.00, 1, 2);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 1000.00, 1, 2);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 1000.00, 1, 2);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 2500.00, 1, 3);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 200.00, 1, 4);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 10000.00, 1, 4);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 2000.00, 1, 6);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 2000.00, 1, 6);
INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID) VALUES (SEQUENCE_LOANID.NEXTVAL, 5000.00, 1, 7);


-- CREATE PROCEDURES

-- INSERT NEW EMPLOYEE
CREATE OR REPLACE PROCEDURE SP_INSERT_EMPLOYEE
(FIRSTNAME IN EMPLOYEE.FIRSTNAME%TYPE,
 LASTNAME IN EMPLOYEE.LASTNAME%TYPE,
 USERNAME IN EMPLOYEE.USERNAME%TYPE,
 PASSWORD IN EMPLOYEE.PASSWORD%TYPE,
 ADDRESS IN EMPLOYEE.ADDRESS%TYPE,
 CITY IN EMPLOYEE.CITY%TYPE,
 STATE IN EMPLOYEE.STATE%TYPE,
 ZIP EMPLOYEE.ZIP%TYPE,
 PHONENUMBER IN EMPLOYEE.PHONENUMBER%TYPE,
 DEPARTMENTID IN EMPLOYEE.DEPARTMENTID%TYPE,
 COMPANYID IN EMPLOYEE.COMPANYID%TYPE)
AS
BEGIN
  INSERT INTO EMPLOYEE(EMPLOYEEID, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID) 
  VALUES(SEQUENCE_EMPLOYEEID.NEXTVAL, FIRSTNAME, LASTNAME, USERNAME, PASSWORD, ADDRESS, CITY, STATE, ZIP, PHONENUMBER, DEPARTMENTID, COMPANYID);
END SP_INSERT_EMPLOYEE;

-- INSERT NEW LOAN
CREATE OR REPLACE PROCEDURE SP_INSERT_LOAN
(LOANVALUE IN LOAN.LOANVALUE%TYPE,
 EMPLOYEEID IN LOAN.EMPLOYEEID%TYPE,
 SUCCESS OUT BOOLEAN)
AS
  COMPANYID LOAN.COMPANYID%TYPE;
BEGIN
  -- SELECT COMPANY ID FOR EMPLOYEE ID
  SELECT COMPANYID
  INTO COMPANYID
  FROM EMPLOYEE
  WHERE EMPLOYEE.EMPLOYEEID = EMPLOYEEID;
  -- INSERT NEW LOAN 
  INSERT INTO LOAN (LOANID, LOANVALUE, COMPANYID, EMPLOYEEID)
  VALUES (SEQUENCE_LOANID.NEXTVAL, 
  LOANVALUE, 
  COMPANYID, 
  EMPLOYEEID);
  -- THE PROCEDURE RETURN A BOOLEAN VALUES TO TELL THE APPLICATION IF THERE HAS BEEN AN ERROR OR NOT
  SUCCESS := TRUE;
-- EXCEPTION HANDLING
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    SUCCESS := FALSE;
END SP_INSERT_LOAN;


CREATE OR REPLACE PROCEDURE SP_INSERT_TAX
(EMPLOYEEID IN EMPLOYEE.EMPLOYEEID%TYPE)
AS
BEGIN
  -- Call created function to generate tax here
  -- To replace with values got from function
  INSERT INTO TAX (TAXID, TAXVALUE, DOCUMENT, TAXYEAR, EMPLOYEEID) 
  VALUES (SEQUENCE_TAXID.NEXTVAL, 4850.50, 'T4', 2015, 1);
END SP_INSERT_TAX;

COMMIT;



